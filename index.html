<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ミタニ市長選挙 ボートマッチ（最新版）</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#111111; --muted:#5f6b7a; --card:#ffffff; --line:#e5e7eb;
      --accent:#2563eb; --accent2:#16a34a; --danger:#ef4444; --warn:#f59e0b
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;line-height:1.6}
    a{color:var(--accent)}
    .container{max-width:980px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;background:linear-gradient(180deg,#ffffff,rgba(255,255,255,.9));backdrop-filter:blur(6px);z-index:2;border-bottom:1px solid var(--line)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent2), var(--warn));box-shadow:0 0 0 2px var(--line)}
    h1{font-size:1.25rem;margin:0}
    h2{margin:.2rem 0 .6rem}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:16px 0}
    .grid{display:grid;gap:12px}
    .q{padding:12px;border-radius:14px;border:1px solid var(--line);background:#fafafa}
    .q h3{margin:.2rem 0 .6rem;font-size:1rem}
    .opts{display:flex;flex-wrap:wrap;gap:8px}
    .opt{display:flex;gap:6px;align-items:center;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff}
    button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .primary{background:var(--accent);color:#fff}
    .ghost{background:#fff;color:var(--fg);border:1px solid var(--line)}
    .muted{color:var(--muted)}
    .bar{height:12px;background:#f3f4f6;border-radius:999px;overflow:hidden;border:1px solid var(--line)}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#60a5fa);width:0%}
    .res-grid{display:grid;gap:12px}
    @media(min-width:720px){.res-grid{grid-template-columns:1fr 1fr 1fr}}
    .res-card{padding:14px;border:1px solid var(--line);border-radius:14px;background:#fff}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#f8fafc;font-size:.75rem;color:var(--muted)}
    table{width:100%;border-collapse:collapse;background:#fff}
    th,td{border-bottom:1px solid var(--line);padding:8px;text-align:left;vertical-align:top}
    .small{font-size:.9rem}
    .footer{font-size:.85rem;color:var(--muted);text-align:center;margin:24px 0}
    .hint{font-size:.9rem;color:var(--muted)}
    .sticky-cta{position:sticky;bottom:0;background:linear-gradient(0deg,#ffffff,transparent);padding:10px}
    .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select{background:#fff;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:8px}
    .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;border:1px solid #00000020;border-radius:10px;padding:10px 12px;font-size:.9rem;opacity:0;transition:.3s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>ミタニ市長選挙 ボートマッチ（最新版）</h1>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <p class="small">現在ミタニ市長選挙が行われています。Z地区にはいわゆるNIMBY施設が多く立地しています。先日のZ地区のゴミ焼却炉の火災事故を受け、<strong>新しいゴミ焼却炉の設置場所や費用負担</strong>が、次の市長選挙の主要争点です。</p>


      <div class="flex">
        <label for="district">あなたの居住地区：</label>
        <select id="district" aria-label="あなたの地区">
          <option value="X">X地区</option>
          <option value="Y">Y地区</option>
          <option value="Z">Z地区</option>
        </select>
      </div>
    </section>

    <section id="questions" class="card">
      <h2>◆ 設問（はい / どちらともいえない / いいえ）</h2>
      <div class="hint">未選択の設問はスコア計算から除外されます。</div>
      <div class="grid" id="qList"></div>

      <div class="sticky-cta flex">
        <button class="primary" id="calcBtn">一致度を診断</button>
        <button class="ghost" id="clearBtn">リセット</button>
        <button class="ghost" id="shareBtn">結果を共有</button>
      </div>
    </section>

    <section id="results" class="card" hidden>
      <h2>◆ 結果</h2>
      <div id="winnerLine" class="small" style="margin-bottom:8px"></div>
      <div class="res-grid" id="scoreCards"></div>
      <details class="card" style="margin-top:12px">
        <summary>設問別の一致状況（開く）</summary>
        <div id="detailsTable"></div>
      </details>
    </section>

    <section class="footer">
      <p>© ミタニ市ボートマッチ（架空）｜単一HTML・外部通信なし｜GitHub Pages にそのまま置けます</p>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
  // ====== 設問（ご指定の6問） ======
  const QUESTIONS = [
    { id:1, text:"新しいゴミ焼却炉は、これまで通りZ地区に建設すべきだと思いますか？" },
    { id:2, text:"Z地区にはすでに多くのNIMBY施設が存在するため、新しいゴミ焼却炉は別の地区に建設すべきだと思いますか？" },
    { id:3, text:"『Z地区にばかり負担が集中している』という住民の声に、市として応えるべきだと思いますか？" },
    { id:4, text:"ミタニ市には新しいゴミ焼却炉を建設せず、隣のハセ市に委託すべきだと思いますか？" },
    { id:5, text:"現在の住民税の負担額を引き上げることに賛成ですか？" },
    { id:6, text:"ミタニ市のゴミの排出量を減らすべきだと思いますか？" },
  ];

  // 表示ラベル
  const ANSWER_LABELS = ["はい","どちらともいえない","いいえ"];
  // 数値化：はい=+1 / 中立=0 / いいえ=-1
  const MAP = { "はい":1, "どちらともいえない":0, "いいえ":-1 };

  // ====== 候補者と回答（ご指定どおり） ======
  const CANDIDATES = [
    { key:"kanzaki", name:"神崎 豪", color:"linear-gradient(90deg,#60a5fa,#3b82f6)", answers:{
      1:"はい",
      2:"いいえ",
      3:"いいえ",
      4:"いいえ",
      5:"はい",
      6:"どちらともいえない"
    }},
    { key:"kazama", name:"風間 裕也", color:"linear-gradient(90deg,#86efac,#16a34a)", answers:{
      1:"いいえ",
      2:"はい",
      3:"はい",
      4:"いいえ",
      5:"いいえ",
      6:"どちらともいえない"
    }},
    { key:"himejima", name:"姫島 ノエル", color:"linear-gradient(90deg,#fde68a,#f59e0b)", answers:{
      1:"いいえ",
      2:"どちらともいえない",
      3:"はい",
      4:"はい",
      5:"はい",
      6:"はい"
    }}
  ];

  // ====== UI生成 ======
  const qList = document.getElementById('qList');
  const results = document.getElementById('results');
  const scoreCards = document.getElementById('scoreCards');
  const detailsTable = document.getElementById('detailsTable');
  const winnerLine = document.getElementById('winnerLine');
  const toast = document.getElementById('toast');

  function makeQuestion(q){
    const wrap = document.createElement('div');
    wrap.className = 'q';
    const h = document.createElement('h3');
    h.textContent = `${q.id}. ${q.text}`;
    wrap.appendChild(h);

    const opts = document.createElement('div');
    opts.className = 'opts';
    for (const label of ANSWER_LABELS){
      const id = `q${q.id}-${label}`;
      const el = document.createElement('label');
      el.className = 'opt';
      el.innerHTML = `<input type="radio" name="q${q.id}" id="${id}" value="${label}"> <span>${label}</span>`;
      opts.appendChild(el);
    }
    wrap.appendChild(opts);
    return wrap;
  }

  function renderQuestions(){
    qList.innerHTML = '';
    QUESTIONS.forEach(q=> qList.appendChild(makeQuestion(q)));
  }
  renderQuestions();

  // ====== スコア計算 ======
  // 類似度：U,C∈{-1,0,1} として d=|U-C|, s=(2-d)/2 → 一致1 / 片方中立0.5 / 真逆0
  function similarity(u, c){
    const d = Math.abs(u - c);
    return (2 - d) / 2;
  }

  function calcScores(){
    const user = {};
    let answered = 0;

    for (const q of QUESTIONS){
      const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
      if (!sel) continue;
      const v = MAP[sel.value];
      user[q.id] = v; answered++;
    }

    const perCandidate = CANDIDATES.map(c =>{
      let score = 0, denom = 0;
      const perQ = [];
      for (const q of QUESTIONS){
        if (user[q.id] === undefined){ perQ.push({qid:q.id, s:null}); continue; }
        const u = user[q.id];
        const ca = MAP[c.answers[q.id]];
        const s = similarity(u, ca);
        score += s; denom += 1;
        perQ.push({qid:q.id, s, user:u, cand:ca});
      }
      const pct = denom ? Math.round((score/denom)*100) : 0;
      return { key:c.key, name:c.name, color:c.color, pct, perQ };
    });

    perCandidate.sort((a,b)=> b.pct - a.pct);
    return { perCandidate, answered };
  }

  // ====== 表示 ======
  function showResults(){
    const { perCandidate, answered } = calcScores();
    results.hidden = false;

    const district = document.getElementById('district').value;
    const top = perCandidate[0];
    winnerLine.innerHTML = answered
      ? `あなた（<span class="pill">${district}</span>）に最も近いのは <strong>${top.name}</strong>（一致度 <strong>${top.pct}%</strong>）。`
      : 'まだ選択されていない設問があります。回答すると一致度を計算できます。';

    // スコアカード
    scoreCards.innerHTML = '';
    perCandidate.forEach(c =>{
      const card = document.createElement('div');
      card.className = 'res-card';
      card.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div class="small muted">候補者</div>
            <div style="font-weight:800">${c.name}</div>
          </div>
          <div style="min-width:72px;text-align:right;font-weight:800">${c.pct}%</div>
        </div>
        <div class="bar" style="margin-top:8px"><span style="background:${c.color};width:${c.pct}%"></span></div>
      `;
      scoreCards.appendChild(card);
    });

    // 詳細テーブル
    let html = '<table><thead><tr><th>設問</th><th>あなた</th><th>神崎 豪</th><th>風間 裕也</th><th>姫島 ノエル</th></tr></thead><tbody>';
    for (const q of QUESTIONS){
      const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
      const my = sel ? sel.value : '未選択';
      const icon = v => v==='はい' ? '◎' : v==='どちらともいえない' ? '△' : v==='未選択' ? '—' : '×';
      html += `<tr><td>${q.id}. ${q.text}</td><td>${icon(my)} ${my}</td><td>${icon(CANDIDATES[0].answers[q.id])} ${CANDIDATES[0].answers[q.id]}</td><td>${icon(CANDIDATES[1].answers[q.id])} ${CANDIDATES[1].answers[q.id]}</td><td>${icon(CANDIDATES[2].answers[q.id])} ${CANDIDATES[2].answers[q.id]}</td></tr>`;
    }
    html += '</tbody></table>';
    detailsTable.innerHTML = html;
  }

  // ====== 共有・リセット ======
  function toastMsg(msg){
    toast.textContent = msg; toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'), 1800);
  }

  document.getElementById('calcBtn').addEventListener('click', showResults);

  document.getElementById('clearBtn').addEventListener('click', ()=>{
    document.querySelectorAll('input[type=radio]').forEach(i=> i.checked=false);
    results.hidden = true; toastMsg('リセットしました');
  });

  document.getElementById('shareBtn').addEventListener('click', async ()=>{
    const { perCandidate } = calcScores();
    const lines = perCandidate.map((c,i)=> `${i+1}. ${c.name}: ${c.pct}%`).join('\n');
    const text = `ミタニ市ボートマッチ結果\n${lines}\n#MitaniVoteMatch`;
    try{
      if (navigator.share){ await navigator.share({ text }); }
      else{ await navigator.clipboard.writeText(text); toastMsg('結果をクリップボードにコピーしました'); }
    }catch(e){ toastMsg('共有をキャンセルしました'); }
  });
  </script>
</body>
</html>
