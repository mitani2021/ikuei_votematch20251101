<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ミタニ市長選挙 ボートマッチ</title>
  <meta name="description" content="架空のミタニ市長選の公約とあなたの考えの一致度を診断します。スマホ対応・GitHub Pages対応の単一HTML。" />
  <style>
    :root{
      --bg:#0b0c10;--fg:#e8f0fe;--muted:#b7c0d8;--card:#14161d;--line:#1e2230;
      --accent:#4cc9f0;--accent2:#90ee90;--danger:#ff6b6b;--warn:#ffd166;--ok:#38b000
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;line-height:1.6}
    a{color:var(--accent)}
    .container{max-width:980px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;background:linear-gradient(180deg,var(--bg),rgba(11,12,16,.9));backdrop-filter:blur(6px);z-index:2;border-bottom:1px solid var(--line)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent2), var(--warn));box-shadow:0 0 0 2px var(--line)}
    h1{font-size:1.25rem;margin:0}
    h2{margin:.2rem 0 .6rem}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:16px 0}
    .grid{display:grid;gap:12px}
    @media(min-width:720px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    .q{padding:12px;border-radius:14px;border:1px solid #1f2536;background:#0f1219}
    .q h3{margin:.2rem 0 .6rem;font-size:1rem}
    .opts{display:flex;flex-wrap:wrap;gap:8px}
    .opt{display:flex;gap:6px;align-items:center;padding:8px 10px;border:1px solid #283046;border-radius:10px;background:#0e1320}
    .badge{font-size:.75rem;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .primary{background:var(--accent);color:#00223a}
    .ghost{background:#0e1422;color:var(--fg);border:1px solid #26304a}
    .danger{background:var(--danger);color:#380000}
    .muted{color:var(--muted)}
    .bar{height:12px;background:#0d1321;border-radius:999px;overflow:hidden;border:1px solid #1f2a44}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7ee8fa);width:0%}
    .res-grid{display:grid;gap:12px}
    @media(min-width:720px){.res-grid{grid-template-columns:1fr 1fr 1fr}}
    .res-card{padding:14px;border:1px solid #283046;border-radius:14px;background:#0f141f}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #2a3553;background:#0b1221;font-size:.75rem;color:var(--muted)}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #1f2538;padding:8px;text-align:left}
    .small{font-size:.9rem}
    .footer{font-size:.85rem;color:var(--muted);text-align:center;margin:24px 0}
    .hint{font-size:.9rem;color:var(--muted)}
    .sticky-cta{position:sticky;bottom:0;background:linear-gradient(0deg,var(--bg),transparent);padding:10px}
    .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select, .checkbox{background:#0e1422;color:var(--fg);border:1px solid #26304a;border-radius:10px;padding:8px}
    .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#0e1422;border:1px solid #26304a;border-radius:10px;padding:10px 12px;font-size:.9rem;opacity:0;transition:.3s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>ミタニ市長選挙 ボートマッチ</h1>
        <div class="muted small">架空の市で、公約との一致度を診断します（スマホ対応）</div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>◆ 前提とあなたの状況</h2>
      <p class="small">ミタニ市は2000年にX市・Y町・Z村が合併し、<strong>X地区・Y地区・Z地区</strong>の3地区で構成。Z地区には迷惑施設が集中。2025年、Z地区の焼却炉火災により<strong>新設場所</strong>が争点に。</p>
      <div class="flex">
        <label for="district">あなたの居住地区：</label>
        <select id="district" aria-label="あなたの地区">
          <option value="X">X地区</option>
          <option value="Y">Y地区</option>
          <option value="Z">Z地区</option>
          <option value="不明">選択しない</option>
        </select>
        <span class="hint">（結果の解釈にのみ表示。スコアには影響しません）</span>
      </div>
    </section>

    <section id="questions" class="card">
      <h2>◆ 設問（賛成 / どちらともいえない / 反対）</h2>
      <div class="hint">重要だと思う設問は「重要」にチェック（重み×2）。未回答はスコア計算から除外されます。</div>
      <div class="grid" id="qList"></div>

      <div class="sticky-cta flex">
        <button class="primary" id="calcBtn">一致度を診断</button>
        <button class="ghost" id="clearBtn">リセット</button>
        <button class="ghost" id="shareBtn">結果を共有</button>
      </div>
    </section>

    <section id="results" class="card" hidden>
      <h2>◆ 結果</h2>
      <div id="winnerLine" class="small" style="margin-bottom:8px"></div>
      <div class="res-grid" id="scoreCards"></div>
      <details class="card" style="margin-top:12px">
        <summary>設問別の一致状況（開く）</summary>
        <div id="detailsTable"></div>
      </details>
    </section>

    <section class="footer">
      <p>© ミタニ市ボートマッチ（架空）｜単一HTML・外部通信なし｜GitHub Pages にそのまま置けます</p>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <script>
  // ====== 設問と候補者データ ======
  const QUESTIONS = [
    { id:1, text:"新しいゴミ焼却炉は、これまで通りZ地区に建設すべきだと思いますか？" },
    { id:2, text:"Z地区にはすでに迷惑施設が多いため、新しいゴミ焼却炉は別の地区（X地区やY地区）に建設すべきだと思いますか？" },
    { id:3, text:"ミタニ市には新しいゴミ焼却炉を建設せず、隣のハセ市に委託すべきだと思いますか？" },
    { id:4, text:"新しいゴミ焼却炉の建設費用を確保するためには、市民税を増税してもよいと思いますか？" },
    { id:5, text:"現在の税負担は維持すべきだと思いますか？" },
    { id:6, text:"ハセ市への委託に必要な大幅増税をしてでも、ミタニ市に焼却炉を作らない方が良いと思いますか？" },
    { id:7, text:"ミタニ市のゴミの排出量をこれまで以上に減らすべきだと思いますか？" },
    { id:8, text:"ゴミ焼却炉の整備よりも、リサイクルや再利用の仕組みに力を入れるべきだと思いますか？" },
    { id:9, text:"公共施設や迷惑施設は、市内の地区ごとに公平に分担して建設されるべきだと思いますか？" },
    { id:10,text:"『Z地区にばかり負担が集中している』という住民の声に、市として応えるべきだと思いますか？" },
  ];

  // 数値化マップ：賛成(はい)=+1 / 中立=0 / 反対(いいえ)=-1
  const MAP = { "はい":1, "賛成":1, "どちらともいえない":0, "反対":-1, "いいえ":-1 };

  // 候補者と回答
  const CANDIDATES = [
    { key:"kanzaki", name:"神崎 豪", color:"linear-gradient(90deg,#4cc9f0,#4895ef)", answers:{
      1:"はい",2:"いいえ",3:"いいえ",4:"はい",5:"いいえ",6:"いいえ",7:"いいえ",8:"どちらともいえない",9:"いいえ",10:"いいえ"
    }},
    { key:"kazama", name:"風間 裕也", color:"linear-gradient(90deg,#90ee90,#38b000)", answers:{
      1:"いいえ",2:"はい",3:"いいえ",4:"いいえ",5:"はい",6:"いいえ",7:"どちらともいえない",8:"どちらともいえない",9:"はい",10:"はい"
    }},
    { key:"himejima", name:"姫島 ノエル", color:"linear-gradient(90deg,#ffd166,#ff9f1c)", answers:{
      1:"いいえ",2:"どちらともいえない",3:"はい",4:"はい",5:"いいえ",6:"はい",7:"はい",8:"はい",9:"はい",10:"はい"
    }}
  ];

  // ====== UI 生成 ======
  const qList = document.getElementById('qList');
  const results = document.getElementById('results');
  const scoreCards = document.getElementById('scoreCards');
  const detailsTable = document.getElementById('detailsTable');
  const winnerLine = document.getElementById('winnerLine');
  const toast = document.getElementById('toast');

  const ANSWERS = ["賛成","どちらともいえない","反対"]; // 表示順

  function makeQuestion(q){
    const wrap = document.createElement('div');
    wrap.className = 'q';
    const h = document.createElement('h3');
    h.textContent = `${q.id}. ${q.text}`;
    wrap.appendChild(h);

    const opts = document.createElement('div');
    opts.className = 'opts';
    for (const label of ANSWERS){
      const id = `q${q.id}-${label}`;
      const el = document.createElement('label');
      el.className = 'opt';
      el.innerHTML = `<input type="radio" name="q${q.id}" id="${id}" value="${label}"> <span>${label}</span>`;
      opts.appendChild(el);
    }

    // 未回答も許可（スコアから除外）
    const noAns = document.createElement('label');
    noAns.className = 'opt';
    noAns.innerHTML = `<input type="radio" name="q${q.id}" value="未回答"> <span class="muted">未回答</span>`;
    opts.appendChild(noAns);

    // 重要チェック
    const imp = document.createElement('div');
    imp.className = 'controls';
    imp.innerHTML = `<label class="opt"><input type="checkbox" id="w${q.id}" class="checkbox"> <span>重要（重み×2）</span></label>`;

    wrap.appendChild(opts);
    wrap.appendChild(imp);
    return wrap;
  }

  function renderQuestions(){
    qList.innerHTML = '';
    QUESTIONS.forEach(q=> qList.appendChild(makeQuestion(q)) );
  }

  renderQuestions();

  // ====== スコア計算 ======
  // 距離ベースの類似度： user(U)とcandidate(C)の数値化値の差 d=|U-C|
  // 類似度 s = (2 - d) / 2  => 完全一致1 / 中立片方0.5 / 真逆0
  function similarity(u, c){
    const d = Math.abs(u - c);
    return (2 - d) / 2; // 1, 0.5, 0
  }

  function calcScores(){
    const user = {};      // { qid: value(-1..1) }
    const weights = {};   // { qid: 1 or 2 }
    let answered = 0;

    for (const q of QUESTIONS){
      const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
      const imp = document.getElementById(`w${q.id}`);
      weights[q.id] = imp && imp.checked ? 2 : 1;
      if (!sel || sel.value === '未回答') continue;
      const v = sel.value === '賛成' ? 1 : sel.value === 'どちらともいえない' ? 0 : -1;
      user[q.id] = v; answered++;
    }

    const perCandidate = CANDIDATES.map(c =>{
      let score = 0, denom = 0;
      const perQ = [];
      for (const q of QUESTIONS){
        if (user[q.id] === undefined) { perQ.push({qid:q.id, s:null}); continue; }
        const u = user[q.id];
        const ca = MAP[c.answers[q.id]]; // -1..1
        const w = weights[q.id];
        const s = similarity(u, ca);
        score += s * w;
        denom += 1 * w;
        perQ.push({qid:q.id, s, user:u, cand:ca});
      }
      const pct = denom ? Math.round((score / denom) * 100) : 0;
      return { key:c.key, name:c.name, color:c.color, pct, perQ };
    });

    perCandidate.sort((a,b)=> b.pct - a.pct);
    return { perCandidate, answered };
  }

  // ====== 表示 ======
  function showResults(){
    const { perCandidate, answered } = calcScores();
    results.hidden = false;

    const district = document.getElementById('district').value;
    const top = perCandidate[0];
    winnerLine.innerHTML = answered
      ? `あなた（<span class="pill">${district}</span>）に最も近いのは <strong>${top.name}</strong>（一致度 <strong>${top.pct}%</strong>）。`
      : '未回答の設問があります。回答すると一致度を計算できます。';

    scoreCards.innerHTML = '';
    perCandidate.forEach(c =>{
      const card = document.createElement('div');
      card.className = 'res-card';
      card.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <div class="small muted">候補者</div>
            <div style="font-weight:800">${c.name}</div>
          </div>
          <div style="min-width:72px;text-align:right;font-weight:800">${c.pct}%</div>
        </div>
        <div class="bar" style="margin-top:8px"><span style="background:${c.color};width:${c.pct}%"></span></div>
      `;
      scoreCards.appendChild(card);
    });

    // 詳細テーブル
    let html = '<table><thead><tr><th>設問</th><th>あなた</th><th>神崎 豪</th><th>風間 裕也</th><th>姫島 ノエル</th></tr></thead><tbody>';
    for (const q of QUESTIONS){
      const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
      const my = sel ? sel.value : '未回答';
      const icon = v => v==='賛成'||v==='はい' ? '◎' : v==='どちらともいえない' ? '△' : v==='未回答' ? '—' : '×';
      html += `<tr><td>${q.id}. ${q.text}</td><td>${icon(my)} ${my}</td><td>${icon(CANDIDATES[0].answers[q.id])} ${CANDIDATES[0].answers[q.id]}</td><td>${icon(CANDIDATES[1].answers[q.id])} ${CANDIDATES[1].answers[q.id]}</td><td>${icon(CANDIDATES[2].answers[q.id])} ${CANDIDATES[2].answers[q.id]}</td></tr>`;
    }
    html += '</tbody></table>';
    detailsTable.innerHTML = html;
  }

  // ====== 共有・リセット ======
  function toastMsg(msg){
    toast.textContent = msg; toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'), 1800);
  }

  document.getElementById('calcBtn').addEventListener('click', showResults);

  document.getElementById('clearBtn').addEventListener('click', ()=>{
    document.querySelectorAll('input[type=radio]').forEach(i=> i.checked=false);
    document.querySelectorAll('input[type=checkbox]').forEach(i=> i.checked=false);
    results.hidden = true; toastMsg('リセットしました');
  });

  document.getElementById('shareBtn').addEventListener('click', async ()=>{
    const { perCandidate } = calcScores();
    const lines = perCandidate.map((c,i)=> `${i+1}. ${c.name}: ${c.pct}%`).join('\n');
    const text = `ミタニ市ボートマッチ結果\n${lines}\n#MitaniVoteMatch`;
    try{
      if (navigator.share){ await navigator.share({ text }); }
      else{ await navigator.clipboard.writeText(text); toastMsg('結果をクリップボードにコピーしました'); }
    }catch(e){ toastMsg('共有をキャンセルしました'); }
  });
  </script>
</body>
</html>
